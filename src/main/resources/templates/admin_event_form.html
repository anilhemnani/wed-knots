<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <title th:text="${event.id != null ? 'Edit Event' : 'Create New Event'}">Event Form</title>
    <meta charset="UTF-8">
    <th:block th:replace="~{_bootstrap_head :: head}"></th:block>
</head>
<body class="bg-light">
<th:block th:replace="~{_navbar :: adminNav}"></th:block>
<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-md-8">
      <div class="card shadow">
        <div class="card-header bg-primary text-white">
          <h4 class="mb-0" th:text="${event.id != null ? 'Edit Event' : 'Create New Event'}">Event Form</h4>
        </div>
        <div class="card-body">
          <form th:action="${event.id != null ? '/admin/events/' + event.id + '/edit' : '/admin/events/new'}"
                method="post" th:object="${event}">

            <div class="mb-3">
              <label for="name" class="form-label">Event Name <span class="text-danger">*</span></label>
              <input type="text" class="form-control" id="name" th:field="*{name}" required
                     placeholder="e.g., Ravi & Meera Wedding">
            </div>

            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="bride_name" class="form-label">Bride Name <span class="text-danger">*</span></label>
                <input type="text" class="form-control" id="bride_name" th:field="*{brideName}" required
                       placeholder="Bride's name">
              </div>
              <div class="col-md-6 mb-3">
                <label for="groom_name" class="form-label">Groom Name <span class="text-danger">*</span></label>
                <input type="text" class="form-control" id="groom_name" th:field="*{groomName}" required
                       placeholder="Groom's name">
              </div>
            </div>

            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="date" class="form-label">Event Date <span class="text-danger">*</span></label>
                <input type="date" class="form-control" id="date" th:field="*{date}" required>
              </div>
              <div class="col-md-6 mb-3">
                <label for="status" class="form-label">Status <span class="text-danger">*</span></label>
                <select class="form-select" id="status" th:field="*{status}" required>
                  <option value="">Select status</option>
                  <option value="Draft">Draft</option>
                  <option value="Published">Published</option>
                  <option value="Completed">Completed</option>
                  <option value="Cancelled">Cancelled</option>
                </select>
              </div>
            </div>

            <div class="row">
              <div class="col-md-12 mb-3">
                <label for="subdomain" class="form-label">Subdomain <span class="text-danger">*</span></label>
                <input type="text" class="form-control" id="subdomain" th:field="*{subdomain}"
                       th:disabled="${event.id != null}" required
                       placeholder="e.g., pratibha-karthik (lowercase, alphanumeric and hyphens only)"
                       pattern="^[a-z0-9-]+$"
                       title="Subdomain must be lowercase letters, numbers, and hyphens only">
                <div class="form-text" th:if="${event.id == null}">
                  Unique identifier for public event page. Can only be set during creation. Access via: http://domain.com/public/{subdomain}
                </div>
                <div class="form-text alert alert-info mt-2" th:if="${event.id != null}">
                  <strong>‚ö†Ô∏è Immutable:</strong> Subdomain cannot be changed after event creation. Current: <code th:text="${event.subdomain}"></code>
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="expected_arrival" class="form-label">Expected Guest Arrival Date</label>
                <input type="date" class="form-control" id="expected_arrival" th:field="*{expectedGuestArrivalDate}">
              </div>
              <div class="col-md-6 mb-3">
                <label for="expected_departure" class="form-label">Expected Guest Departure Date</label>
                <input type="date" class="form-control" id="expected_departure" th:field="*{expectedGuestDepartureDate}">
              </div>
            </div>

            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="preferred_airport" class="form-label">Preferred Travel Airport</label>
                <input type="text" class="form-control" id="preferred_airport" th:field="*{preferredTravelAirport}" placeholder="e.g., Mangluru, DEL, BOM">
              </div>
              <div class="col-md-6 mb-3">
                <label for="preferred_station" class="form-label">Preferred Travel Station</label>
                <input type="text" class="form-control" id="preferred_station" th:field="*{preferredTravelStation}" placeholder="e.g., Kasaragod, NDLS, BCT">
              </div>
            </div>

            <!-- WhatsApp Configuration Section -->
            <div class="card bg-light mt-4 mb-4">
              <div class="card-header bg-success text-white">
                <h5 class="mb-0">
                  <i class="bi bi-whatsapp"></i> WhatsApp Cloud API Configuration
                </h5>
              </div>
              <div class="card-body">
                <div class="alert alert-info" role="alert">
                  <strong>üìå Note:</strong> Configure your WhatsApp Cloud API credentials to enable WhatsApp message sending and receiving for this event.
                  Get these values from your <a href="https://business.facebook.com/" target="_blank">Meta Business Manager</a>.
                </div>

                <div class="mb-3">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="whatsapp_api_enabled" th:field="*{whatsappApiEnabled}">
                    <label class="form-check-label" for="whatsapp_api_enabled">
                      Enable WhatsApp Cloud API for this event
                    </label>
                  </div>
                </div>

                <div class="row">
                  <div class="col-md-6 mb-3">
                    <label for="whatsapp_phone_number_id" class="form-label">
                      WhatsApp Phone Number ID
                      <span class="text-danger">*</span> (if enabled)
                    </label>
                    <input type="text" class="form-control" id="whatsapp_phone_number_id"
                           th:field="*{whatsappPhoneNumberId}"
                           placeholder="e.g., 120363456789012"
                           pattern="^\d{15,}$"
                           title="Phone Number ID should be a numeric ID from Meta">
                    <div class="form-text">
                      Find this in Meta Business Manager ‚Üí WhatsApp ‚Üí Senders ‚Üí Your phone number
                    </div>
                  </div>
                  <div class="col-md-6 mb-3">
                    <label for="whatsapp_business_account_id" class="form-label">
                      WhatsApp Business Account ID
                      <span class="text-danger">*</span> (if enabled)
                    </label>
                    <input type="text" class="form-control" id="whatsapp_business_account_id"
                           th:field="*{whatsappBusinessAccountId}"
                           placeholder="e.g., 102093456789012"
                           pattern="^\d{15,}$"
                           title="Business Account ID should be a numeric ID from Meta">
                    <div class="form-text">
                      Find this in Meta Business Manager ‚Üí Settings ‚Üí Business Account settings
                    </div>
                  </div>
                </div>

                <div class="mb-3">
                  <label for="whatsapp_access_token" class="form-label">
                    WhatsApp Access Token
                    <span class="text-danger">*</span> (if enabled)
                  </label>
                  <input type="password" class="form-control" id="whatsapp_access_token"
                         th:field="*{whatsappAccessToken}"
                         placeholder="Your access token (hidden for security)">
                  <div class="form-text">
                    Generate a System User Access Token with manage_whatsapp_business_messaging permission
                  </div>
                </div>

                <div class="row">
                  <div class="col-md-6 mb-3">
                    <label for="whatsapp_api_version" class="form-label">WhatsApp API Version</label>
                    <input type="text" class="form-control" id="whatsapp_api_version"
                           th:field="*{whatsappApiVersion}"
                           placeholder="e.g., v24.0" value="v24.0">
                    <div class="form-text">
                      Default: v24.0. Update if needed based on Meta's API roadmap.
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="d-flex justify-content-between mt-4">
              <a href="/admin/dashboard" class="btn btn-secondary">
                <i class="bi bi-arrow-left"></i> Cancel
              </a>
              <button type="submit" class="btn btn-primary">
                <i class="bi bi-save"></i>
                <span th:text="${event.id != null ? 'Update Event' : 'Create Event'}">Save</span>
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
</body>
</html>

